# Plan: Fix NextAuth Login ECONNREFUSED Error

## Problem
NextAuth's `authorize` callback in `auth.ts` is calling `/api/auth/login` via HTTP fetch, which creates a self-referential request causing `ECONNREFUSED` errors.

**Current flow:**
```
auth.ts authorize()
  → fetch http://localhost:3005/api/auth/login
    → /api/auth/login/route.ts
      → loginUser() from auth.service.ts
```

**Error:**
```
TypeError: fetch failed
[cause]: [AggregateError] { code: 'ECONNREFUSED' }
```

## Root Cause
The NextAuth authorize callback runs on the server and tries to make an HTTP request back to the same Next.js server. This circular dependency can fail, especially during server-side rendering or in certain deployment environments.

## Solution
Remove the HTTP round-trip by directly calling the auth service from NextAuth's authorize callback.

**New flow:**
```
auth.ts authorize()
  → loginUser() from auth.service.ts (direct call)
```

## Implementation Steps

### 1. Update `auth.ts`
- Import `loginUser` from `@/services/auth.service`
- Remove the fetch call to `/api/auth/login`
- Call `loginUser()` directly with email/password
- Handle the `LoginResult` response structure

### 2. Keep `/api/auth/login/route.ts`
- Leave the API route intact for potential external use or direct API calls
- No changes needed to this file

### 3. Test the fix
- Verify login works with the direct service call
- Confirm no ECONNREFUSED errors

## Benefits
- Eliminates circular HTTP dependency
- Faster login (no HTTP round-trip)
- More reliable in all environments
- Cleaner architecture (service layer reuse)

## Files to Modify
- `auth.ts` - Replace fetch with direct service call

## Files to Keep As-Is
- `app/api/auth/login/route.ts` - Keep for potential external API use
- `services/auth.service.ts` - No changes needed
